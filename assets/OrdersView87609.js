import{o as P,F as I,c as M,a as W,m as p,x as $,_ as x,r as w,p as j,b as i,e as d,f as l,w as s,h as C,i as m,s as E,q as T,g as _,n as G,v as H}from"../index87609.js";import{u as U}from"./order87609.js";import{g as J,e as Q,t as X,d as Y,i as Z}from"./helpers87609.js";import{u as D}from"./sidebar87609.js";import{u as ee}from"./user87609.js";import{u as oe}from"./workarea87609.js";const te={setup(){P(()=>{y.value=!0,e.value={first:0,rows:h.value.rows,sortField:null,sortOrder:null,filters:b.value},I.register("myfilter",(o,v)=>o===v),F()});const f=U(),n=D(),u=ee(),t=oe(),V=M(()=>f.responseOrders),k=M(()=>u.allUsers),g=M(()=>t.allWorkarea),c=W(),h=p(),S=p(),O=p([{name:"Carta di credito",value:"credit_card"},{name:"Satispay",value:"Satispay"},{name:"Stripe",value:"stripe"}]),b=p({coupon_code:{value:"",matchMode:"eq"},user_id:{value:"",matchMode:"eq"},typology:{value:"",matchMode:"eq"},workarea_id:{value:"",matchMode:"eq"},created_at:{value:"",matchMode:"like"},payment_method:{value:"",matchMode:"eq"},invoice_number:{value:"",matchMode:"eq"}}),y=p(!0),e=p(),r=p(0),a=p([{label:"My Filter",value:"myfilter"}]);function F(){y.value=!0;let o=new Map;o=J(b,o),o.set("page",e.value.page+1),o.set("per_page",e.value.rows),e.value.sortField?e.value.sortOrder==1?o.set("sorted_by",e.value.sortField+"_asc"):o.set("sorted_by",e.value.sortField+"_desc"):o.set("sorted_by","created_at_desc"),setTimeout(()=>{N(o)},Math.random()*1e3+250)}const A=async function(){const o=new Map;await u.fetchAllUsers(o).catch(v=>{})},N=async function(o){await f.fetchAllOrders(o).then(()=>{y.value=!1}).catch(v=>{y.value=!1,Q(c,v)})},q=o=>{e.value=o,F()},K=o=>{e.value=o,F()},R=()=>{e.value.page=0,e.value.filters=b.value,F()},z=function(o){n.setDetailType("order",!1,"Dettaglio ordine",o.id),n.updateSidebar(!0)},B=async function(){await t.fetchAllWorkarea()},L=function(o){var v;return(v=o==null?void 0:o.workarea)!=null&&v.typology?o.workarea.typology:""};return $(async()=>{A(),B()}),{dt:h,responseOrders:V,filters:b,loading:y,totalRecords:r,lazyParams:e,matchModes:a,currentOrder:S,orderStore:f,users:k,workareas:g,payment_methods:O,onPage:q,onSort:K,onFilter:R,showSidebar:z,loadLazyData:F,translateTypology:X,getRowClass:L,formatDataFromUnixTimestamps:Y,formatNumber:Z}},components:{}};const ae={class:"order"},re={key:0},le={key:0},se=_("br",null,null,-1),ne={key:1},ie=_("div",{class:"flex justify-content-end w-full"},"Totale",-1),de={class:"flex justify-content-end"},ce={key:0},ue={key:1},pe={key:0},me={key:1,class:"capitalize"},_e={key:0,class:"pi pi-check-circle text-green-600"},fe={key:1};function he(f,n,u,t,V,k){const g=w("Calendar"),c=w("Column"),h=w("Dropdown"),S=w("InputText"),O=w("Button"),b=w("DataTable"),y=j("tooltip");return i(),d("div",ae,[l(b,{value:t.responseOrders.orders,totalRecords:t.responseOrders.total,lazy:!0,paginator:!0,rows:30,filters:t.filters,"onUpdate:filters":n[0]||(n[0]=e=>t.filters=e),ref:"dt",dataKey:"id",loading:t.loading,onPage:n[1]||(n[1]=e=>t.onPage(e)),onSort:n[2]||(n[2]=e=>t.onSort(e)),onFilter:n[3]||(n[3]=e=>t.onFilter()),filterDisplay:"row",removableSort:"",stripedRows:"",rowClass:t.getRowClass},{empty:s(()=>[C(" Nessun ordine trovato. ")]),default:s(()=>[l(c,{field:"created_at",header:"Data ordine",ref:"created_at",filterField:"created_at",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1,sortable:"",removableSort:"",style:{width:"160px"}},{body:s(({data:e})=>[e.created_at?(i(),d("div",re,m(t.formatDataFromUnixTimestamps(e.created_at)),1)):E("",!0)]),filter:s(({filterModel:e,filterCallback:r})=>[l(g,{inputId:"dateformat",modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,dateFormat:"dd/mm/yy",onKeydown:T(a=>r(),["enter"]),manualInput:!0,placeholder:"Filtra",onDateSelect:a=>r()},null,8,["modelValue","onUpdate:modelValue","onKeydown","onDateSelect"])]),_:1},512),l(c,{field:"workarea_id",header:"Area di lavoro",filterMatchMode:"contains",ref:"workarea_id",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{body:s(({data:e})=>{var r;return[_("div",{class:G(e.workarea.name)},[_("span",null,m(((r=e.workarea)==null?void 0:r.name)||"-"),1)],2)]}),filter:s(({filterModel:e,filterCallback:r})=>[l(h,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,options:t.workareas,optionLabel:"name",optionValue:"id",onChange:a=>r(),placeholder:"Filtra"},null,8,["modelValue","onUpdate:modelValue","options","onChange"])]),_:1},512),l(c,{field:"typology",header:"Tipologia",filterMatchMode:"contains",ref:"typology",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{body:s(({data:e})=>[_("span",null,m(t.translateTypology(e.typology)||"-"),1)]),filter:s(({filterModel:e,filterCallback:r})=>[l(h,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,options:t.orderStore.orderTypology,optionLabel:"name",optionValue:"value",onChange:a=>r(),placeholder:"Filtra"},null,8,["modelValue","onUpdate:modelValue","options","onChange"])]),_:1},512),l(c,{field:"user_id",header:"Utente",filterMatchMode:"contains",ref:"user_id",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{body:s(({data:e})=>[e.user?(i(),d("span",le,[C(m(e.user.full_name)+" ",1),se,C(" "+m(e.user.email),1)])):(i(),d("span",ne,"-"))]),filter:s(({filterModel:e,filterCallback:r})=>[l(h,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,options:t.users,optionLabel:"email",optionValue:"id",onChange:a=>r(),placeholder:"Filtra"},null,8,["modelValue","onUpdate:modelValue","options","onChange"])]),_:1},512),l(c,{field:"coupon_code",header:"Coupon",filterMatchMode:"contains",ref:"coupon_code",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:s(({filterModel:e,filterCallback:r})=>[l(S,{type:"text",modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,onKeydown:T(a=>r(),["enter"]),class:"p-column-filter",placeholder:"Filtra"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1},512),l(c,{field:"total"},{header:s(()=>[ie]),body:s(({data:e})=>[_("div",de,[e.total?(i(),d("span",ce," â‚¬ "+m(t.formatNumber(e.total)+""),1)):(i(),d("span",ue,"-"))])]),_:1}),l(c,{field:"payment_method",header:"Pagamento",filterMatchMode:"contains",ref:"payment_method",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{body:s(({data:e})=>[e.payment_method&&e.payment_method=="credit_card"?(i(),d("span",pe,"Carta di credito")):(i(),d("span",me,m(e.payment_method||"-"),1))]),filter:s(({filterModel:e,filterCallback:r})=>[l(h,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,options:t.payment_methods,optionLabel:"name",optionValue:"value",onChange:a=>r(),placeholder:"Filtra"},null,8,["modelValue","onUpdate:modelValue","options","onChange"])]),_:1},512),l(c,{field:"invoice_number",header:"Fattura",filterMatchMode:"contains",ref:"invoice_number"},{body:s(({data:e})=>[e.invoice?(i(),d("i",_e)):(i(),d("span",fe,"-"))]),_:1},512),l(c,{header:"",style:{width:"4rem"}},{body:s(({data:e})=>[H(l(O,{type:"button",onClick:r=>t.showSidebar(e),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-3",icon:"pi pi-arrow-right",text:"",rounded:""},null,8,["onClick"]),[[y,"Dettaglio",void 0,{top:!0}]])]),_:1})]),_:1},8,["value","totalRecords","filters","loading","rowClass"])])}const ye=x(te,[["render",he]]),ve={setup(){const f=U(),n=M(()=>f.getTotalOrders),u=D();return{totalOrder:n,showSidebar:function(){u.setDetailType("order",!0,"Nuovo ordine",null),u.updateSidebar(!0),u.setShowDetail(!0)}}},components:{OrdersTable:ye}},we={class:"flex justify-content-between align-items-center"},be={class:""},ge={key:0},Fe={key:1};function Me(f,n,u,t,V,k){const g=w("OrdersTable");return i(),d("div",null,[_("div",we,[_("h1",be,[t.totalOrder==1?(i(),d("span",ge," 1 Ordine")):(i(),d("span",Fe,m(t.totalOrder)+" Ordini",1))])]),l(g)])}const xe=x(ve,[["render",Me]]);export{xe as default};
