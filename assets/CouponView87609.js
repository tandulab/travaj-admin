import{o as B,c as M,a as I,m as w,_ as D,r as v,p as z,b as u,e as c,f as n,w as r,g as p,h as T,q as S,i as g,s as U,v as A}from"../index87609.js";import{u as k}from"./coupon87609.js";import{g as O,e as P,d as $,i as L,j as E}from"./helpers87609.js";import{u as q}from"./sidebar87609.js";import{u as G}from"./user87609.js";const H={setup(){B(()=>{_.value=!0,d.value={first:0,rows:y.value.rows,sortField:null,sortOrder:null,filters:f.value},e(),j()});const h=k(),l=q(),m=G(),o=M(()=>h.responseCoupons),b=M(()=>m.allUsers),C=I(),y=w(),i=w(),f=w({global:{value:null,matchMode:"like"},full_name:{value:"",matchMode:"eq"},typology:{value:"",matchMode:"eq"},code:{value:"",matchMode:"eq"},valid_to:{value:"",matchMode:"like"},valid_from:{value:"",matchMode:"like"},limit_to_user_id:{value:"",matchMode:"eq"}}),_=w(!0),d=w(),F=w(0),V=w([{label:"My Filter",value:"myfilter"}]);function e(){_.value=!0;let t=new Map;t=O(f,t),t.set("page",d.value.page+1),t.set("per_page",d.value.rows),t.set("page",d.value.page+1),t.set("per_page",d.value.rows),setTimeout(()=>{s(t)},Math.random()*1e3+250)}const s=async function(t){await h.fetchAllCoupons(t).then(()=>{_.value=!1}).catch(x=>{_.value=!1,P(C,x)})},a=t=>{d.value=t,e()},R=t=>{d.value=t,e()},K=()=>{d.value.page=0,d.value.filters=f.value,e()},N=function(t){l.setDetailType("coupon",!1,"Dettaglio coupon",t.id),l.updateSidebar(!0)},j=async function(){const t=new Map;await m.fetchAllUsers(t).catch(x=>{})};return{dt:y,responseCoupons:o,filters:f,loading:_,totalRecords:F,lazyParams:d,matchModes:V,currentCoupon:i,couponStore:h,users:b,onPage:a,onSort:R,onFilter:K,showSidebar:N,loadLazyData:e,getRowClass:function(t){return t!=null&&t.typology?t.typology:""},formatDataFromUnixTimestamps:$,formatNumber:L,formatDataFromSql:E}},components:{}};const J={class:"coupon"},Q={class:"flex justify-content-between align-items-center"},W={class:"p-input-icon-left w-full mr-3 py-2"},X=p("i",{class:"pi pi-search"},null,-1),Y={class:"capitalize"},Z=p("div",{class:"flex justify-content-center w-full"},"Importo",-1),ee={class:"flex justify-content-center"},oe={key:0},te={key:1},le=p("div",{class:"flex justify-content-center w-full"}," Coupon utilizzati ",-1),ae={class:"flex justify-content-center"},ne={key:0},se={key:1},re={key:0},ie={key:0};function de(h,l,m,o,b,C){const y=v("InputText"),i=v("Column"),f=v("Dropdown"),_=v("Calendar"),d=v("Button"),F=v("DataTable"),V=z("tooltip");return u(),c("div",J,[n(F,{value:o.responseCoupons.coupons,totalRecords:o.responseCoupons.total,lazy:!0,paginator:!0,rows:30,filters:o.filters,"onUpdate:filters":l[2]||(l[2]=e=>o.filters=e),ref:"dt",dataKey:"id",loading:o.loading,onPage:l[3]||(l[3]=e=>o.onPage(e)),onSort:l[4]||(l[4]=e=>o.onSort(e)),onFilter:l[5]||(l[5]=e=>o.onFilter()),filterDisplay:"row",removableSort:"",stripedRows:"",rowClass:o.getRowClass},{header:r(()=>[p("div",Q,[p("span",W,[X,n(y,{modelValue:o.filters.global.value,"onUpdate:modelValue":l[0]||(l[0]=e=>o.filters.global.value=e),placeholder:"Ricerca coupon",class:"border-none w-full",onChange:l[1]||(l[1]=e=>o.onFilter())},null,8,["modelValue"])])])]),empty:r(()=>[T(" Nessun coupon trovato. ")]),default:r(()=>[n(i,{field:"code",header:"Codice",filterMatchMode:"contains",ref:"code",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:r(({filterModel:e,filterCallback:s})=>[n(y,{type:"text",modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,onKeydown:S(a=>s(),["enter"]),class:"p-column-filter",placeholder:"Filtra per codice"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1},512),n(i,{field:"typology",header:"Tipologia",filterMatchMode:"contains",ref:"typology",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{body:r(({data:e})=>[p("span",Y,g(e.typology),1)]),filter:r(({filterModel:e,filterCallback:s})=>[n(f,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,options:o.couponStore.couponsTypology,optionLabel:"name",optionValue:"value",onChange:a=>s(),placeholder:"Filtra per tipologia"},null,8,["modelValue","onUpdate:modelValue","options","onChange"])]),_:1},512),n(i,{field:"amount"},{header:r(()=>[Z]),body:r(({data:e})=>[p("div",ee,[e.amount?(u(),c("span",oe,g(o.formatNumber(e.amount)+"")+" â‚¬",1)):(u(),c("span",te,"-"))])]),_:1}),n(i,{field:"quantity"},{header:r(()=>[le]),body:r(({data:e})=>[p("div",ae,[e.quantity&&e.typology=="promo"?(u(),c("span",ne,g(e.used+" / "+e.quantity),1)):(u(),c("span",se,"-"))])]),_:1}),n(i,{field:"valid_from",header:"Valido dal",ref:"valid_from",filterField:"valid_from",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{body:r(({data:e})=>[e.valid_from?(u(),c("div",re,g(o.formatDataFromSql(e.valid_from)),1)):U("",!0)]),filter:r(({filterModel:e,filterCallback:s})=>[n(_,{inputId:"dateformat",modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,dateFormat:"dd/mm/yy",onKeydown:S(a=>s(),["enter"]),manualInput:!0,placeholder:"Ricerca per data",onDateSelect:a=>s()},null,8,["modelValue","onUpdate:modelValue","onKeydown","onDateSelect"])]),_:1},512),n(i,{field:"valid_to",header:"Valido al",ref:"valid_to",filterField:"valid_to",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{body:r(({data:e})=>[e.valid_to?(u(),c("div",ie,g(o.formatDataFromSql(e.valid_to)),1)):U("",!0)]),filter:r(({filterModel:e,filterCallback:s})=>[n(_,{inputId:"dateformat",modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,dateFormat:"dd/mm/yy",onKeydown:S(a=>s(),["enter"]),manualInput:!0,placeholder:"Ricerca per data",onDateSelect:a=>s()},null,8,["modelValue","onUpdate:modelValue","onKeydown","onDateSelect"])]),_:1},512),n(i,{field:"limit_to_user_id",ref:"limit_to_user_id",header:"Utente",filterField:"limit_to_user_id",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{body:r(({data:e})=>{var s;return[T(g(((s=e.limit_to_user)==null?void 0:s.email)||"-"),1)]}),filter:r(({filterModel:e,filterCallback:s})=>[n(f,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,options:o.users,optionLabel:"email",optionValue:"id",class:"w-full",onChange:a=>s(),placeholder:"Filtra per email"},null,8,["modelValue","onUpdate:modelValue","options","onChange"])]),_:1},512),n(i,{header:"",style:{width:"4rem"}},{body:r(({data:e})=>[A(n(d,{type:"button",onClick:s=>o.showSidebar(e),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-3",icon:"pi pi-arrow-right",text:"",rounded:""},null,8,["onClick"]),[[V,"Dettaglio",void 0,{top:!0}]])]),_:1})]),_:1},8,["value","totalRecords","filters","loading","rowClass"])])}const ue=D(H,[["render",de]]),ce={setup(){const h=k(),l=M(()=>h.getTotalCoupons),m=q();return{totalCoupon:l,showSidebar:function(){m.setDetailType("coupon",!0,"Nuovo coupon",null),m.updateSidebar(!0),m.setShowDetail(!0)}}},components:{CouponTable:ue}},pe={class:"flex justify-content-between align-items-center"},me={class:""},fe={key:0},_e={key:1};function ve(h,l,m,o,b,C){const y=v("Button"),i=v("CouponTable");return u(),c("div",null,[p("div",pe,[p("h1",me,[o.totalCoupon==1?(u(),c("span",fe," 1 Coupon")):(u(),c("span",_e,g(o.totalCoupon)+" Coupon",1))]),n(y,{label:"Aggiungi coupon",onClick:l[0]||(l[0]=f=>o.showSidebar()),class:"mb-3",rounded:"",outlined:""})]),n(i)])}const Fe=D(ce,[["render",ve]]);export{Fe as default};
