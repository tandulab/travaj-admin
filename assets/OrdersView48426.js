import{o as I,F as W,c as k,a as E,m as h,x as q,_ as x,r as b,p as J,b as c,e as u,f as s,w as l,h as T,i as _,s as G,q as U,g as p,n as H,v as Q}from"../index48426.js";import{u as D}from"./order48426.js";import{b as X,c as Y,e as Z,t as ee,f as oe}from"./helpers48426.js";import{u as A,f as te,a as ae}from"./formatData48426.js";import{u as re}from"./user48426.js";import{u as se}from"./workarea48426.js";const le={setup(){I(()=>{y.value=!0,e.value={first:0,rows:v.value.rows,sortField:null,sortOrder:null,filters:F.value},W.register("myfilter",(t,i)=>t===i),M()});const f=D(),n=A(),m=re(),o=se(),O=k(()=>f.responseOrders),V=k(()=>m.allUsers),g=k(()=>o.allWorkarea),d=E(),v=h(),S=h(),C=h([{name:"Satispay",value:"Satispay"},{name:"Stripe",value:"stripe"}]),F=h({global:{value:null,matchMode:"contains"},coupon_code:{value:"",matchMode:"contains"},user_id:{value:"",matchMode:"contains"},typology:{value:"",matchMode:"contains"},workarea_id:{value:"",matchMode:"contains"},created_at:{value:"",matchMode:"contains"},payment_method:{value:"",matchMode:"contains"},invoice_number:{value:"",matchMode:"contains"}}),y=h(!0),e=h(),r=h(0),a=h([{label:"My Filter",value:"myfilter"}]);function M(){y.value=!0;const t=new Map;Object.entries(F.value).forEach(([i,w])=>{if(i=="created_at"){if(w.value){let j=te(w==null?void 0:w.value);X(t,i,j)}}else Y(t,i,w==null?void 0:w.value)}),t.set("page",e.value.page+1),t.set("per_page",e.value.rows),e.value.sortField&&(e.value.sortOrder==1?t.set("sorted_by",e.value.sortField+"_asc"):t.set("sorted_by",e.value.sortField+"_desc")),setTimeout(()=>{P(t)},Math.random()*1e3+250)}const K=async function(){const t=new Map;await m.fetchAllUsers(t).catch(i=>{})},P=async function(t){await f.fetchAllOrders(t).then(()=>{y.value=!1}).catch(i=>{y.value=!1,Z(d,i)})},L=t=>{e.value=t,M()},N=t=>{e.value=t,M()},R=()=>{e.value.page=0,e.value.filters=F.value,M()},z=function(t){n.setDetailType("order",!1,"Dettaglio ordine",t.id),n.updateSidebar(!0)},B=async function(){await o.fetchAllWorkarea()},$=function(t){var i;return(i=t==null?void 0:t.workarea)!=null&&i.typology?t.workarea.typology:""};return q(async()=>{K(),B()}),{dt:v,responseOrders:O,filters:F,loading:y,totalRecords:r,lazyParams:e,matchModes:a,currentOrder:S,orderStore:f,users:V,workareas:g,payment_methods:C,onPage:L,onSort:N,onFilter:R,showSidebar:z,loadLazyData:M,translateTypology:ee,getRowClass:$,formatDataFromUnixTimestamps:ae,formatNumber:oe}},components:{}};const ne={class:"order"},de={key:0},ie={key:0},ce=p("br",null,null,-1),ue={key:1},pe=p("div",{class:"flex justify-content-end w-full"},"Totale",-1),me={class:"flex justify-content-end"},he={key:0},_e={key:1},fe={class:"capitalize"},ve={key:0,class:"pi pi-check-circle text-green-600"},ye={key:1};function we(f,n,m,o,O,V){const g=b("Calendar"),d=b("Column"),v=b("Dropdown"),S=b("InputText"),C=b("Button"),F=b("DataTable"),y=J("tooltip");return c(),u("div",ne,[s(F,{value:o.responseOrders.orders,totalRecords:o.responseOrders.total,lazy:!0,paginator:!0,rows:30,filters:o.filters,"onUpdate:filters":n[0]||(n[0]=e=>o.filters=e),ref:"dt",dataKey:"id",loading:o.loading,onPage:n[1]||(n[1]=e=>o.onPage(e)),onSort:n[2]||(n[2]=e=>o.onSort(e)),onFilter:n[3]||(n[3]=e=>o.onFilter()),filterDisplay:"row",removableSort:"",stripedRows:"",rowClass:o.getRowClass},{empty:l(()=>[T(" Nessun ordine trovato. ")]),default:l(()=>[s(d,{field:"created_at",header:"Data ordine",ref:"created_at",filterField:"created_at",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1,sortable:"",removableSort:"",style:{width:"160px"}},{body:l(({data:e})=>[e.created_at?(c(),u("div",de,_(o.formatDataFromUnixTimestamps(e.created_at)),1)):G("",!0)]),filter:l(({filterModel:e,filterCallback:r})=>[s(g,{inputId:"dateformat",modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,dateFormat:"dd/mm/yy",onKeydown:U(a=>r(),["enter"]),manualInput:!0,placeholder:"Filtra",onDateSelect:a=>r()},null,8,["modelValue","onUpdate:modelValue","onKeydown","onDateSelect"])]),_:1},512),s(d,{field:"workarea_id",header:"Area di lavoro",filterMatchMode:"contains",ref:"workarea_id",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{body:l(({data:e})=>{var r;return[p("div",{class:H(e.workarea.name)},[p("span",null,_(((r=e.workarea)==null?void 0:r.name)||"-"),1)],2)]}),filter:l(({filterModel:e,filterCallback:r})=>[s(v,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,options:o.workareas,optionLabel:"name",optionValue:"id",onChange:a=>r(),placeholder:"Filtra"},null,8,["modelValue","onUpdate:modelValue","options","onChange"])]),_:1},512),s(d,{field:"typology",header:"Tipologia",filterMatchMode:"contains",ref:"typology",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{body:l(({data:e})=>[p("span",null,_(o.translateTypology(e.typology)||"-"),1)]),filter:l(({filterModel:e,filterCallback:r})=>[s(v,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,options:o.orderStore.orderTypology,optionLabel:"name",optionValue:"value",onChange:a=>r(),placeholder:"Filtra"},null,8,["modelValue","onUpdate:modelValue","options","onChange"])]),_:1},512),s(d,{field:"user_id",header:"Utente",filterMatchMode:"contains",ref:"user_id",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{body:l(({data:e})=>[e.user?(c(),u("span",ie,[T(_(e.user.full_name)+" ",1),ce,T(" "+_(e.user.email),1)])):(c(),u("span",ue,"-"))]),filter:l(({filterModel:e,filterCallback:r})=>[s(v,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,options:o.users,optionLabel:"email",optionValue:"id",onChange:a=>r(),placeholder:"Filtra"},null,8,["modelValue","onUpdate:modelValue","options","onChange"])]),_:1},512),s(d,{field:"coupon_code",header:"Coupon",filterMatchMode:"contains",ref:"coupon_code",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:l(({filterModel:e,filterCallback:r})=>[s(S,{type:"text",modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,onKeydown:U(a=>r(),["enter"]),class:"p-column-filter",placeholder:"Filtra"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1},512),s(d,{field:"total"},{header:l(()=>[pe]),body:l(({data:e})=>[p("div",me,[e.total?(c(),u("span",he," â‚¬ "+_(o.formatNumber(e.total)+""),1)):(c(),u("span",_e,"-"))])]),_:1}),s(d,{field:"payment_method",header:"Pagamento",filterMatchMode:"contains",ref:"payment_method",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{body:l(({data:e})=>[p("span",fe,_(e.payment_method||"-"),1)]),filter:l(({filterModel:e,filterCallback:r})=>[s(v,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,options:o.payment_methods,optionLabel:"name",optionValue:"value",onChange:a=>r(),placeholder:"Filtra"},null,8,["modelValue","onUpdate:modelValue","options","onChange"])]),_:1},512),s(d,{field:"invoice_number",header:"Fattura",filterMatchMode:"contains",ref:"invoice_number",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{body:l(({data:e})=>[e.invoice_number?(c(),u("i",ve)):(c(),u("span",ye,"-"))]),filter:l(({filterModel:e,filterCallback:r})=>[s(S,{type:"text",modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,onKeydown:U(a=>r(),["enter"]),class:"p-column-filter",placeholder:"Filtra"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1},512),s(d,{header:"",style:{width:"4rem"}},{body:l(({data:e})=>[Q(s(C,{type:"button",onClick:r=>o.showSidebar(e),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-3",icon:"pi pi-arrow-right",text:"",rounded:""},null,8,["onClick"]),[[y,"Dettaglio",void 0,{top:!0}]])]),_:1})]),_:1},8,["value","totalRecords","filters","loading","rowClass"])])}const be=x(le,[["render",we]]),Fe={setup(){const f=D(),n=k(()=>f.getTotalOrders),m=A();return{totalOrder:n,showSidebar:function(){m.setDetailType("order",!0,"Nuovo ordine",null),m.updateSidebar(!0),m.setShowDetail(!0)}}},components:{OrdersTable:be}},ge={class:"flex justify-content-between align-items-center"},Me={class:""},Se={key:0},ke={key:1};function Oe(f,n,m,o,O,V){const g=b("OrdersTable");return c(),u("div",null,[p("div",ge,[p("h1",Me,[o.totalOrder==1?(c(),u("span",Se," 1 Ordine")):(c(),u("span",ke,_(o.totalOrder)+" Ordini",1))])]),s(g)])}const Ae=x(Fe,[["render",Oe]]);export{Ae as default};
