import{o as A,c as U,a as P,m as b,_ as R,r as y,p as L,b as p,e as m,f as l,w as r,g as _,h as T,q as x,i as C,s as V,v as $}from"../index48426.js";import{u as q}from"./coupon48426.js";import{c as k,b as E,e as N,f as J}from"./helpers48426.js";import{u as K,f as G,a as H,b as Q}from"./formatData48426.js";import{u as W}from"./user48426.js";const X={setup(){A(()=>{h.value=!0,d.value={first:0,rows:g.value.rows,sortField:null,sortOrder:null,filters:v.value},e(),O()});const w=q(),a=K(),f=W(),o=U(()=>w.responseCoupons),F=U(()=>f.allUsers),S=P(),g=b(),i=b(),v=b({global:{value:null,matchMode:"contains"},full_name:{value:"",matchMode:"contains"},typology:{value:"",matchMode:"contains"},code:{value:"",matchMode:"contains"},valid_to:{value:"",matchMode:"contains"},valid_from:{value:"",matchMode:"contains"},limit_to_user_id:{value:"",matchMode:"contains"}}),h=b(!0),d=b(),M=b(0),D=b([{label:"My Filter",value:"myfilter"}]);function e(){h.value=!0;const t=new Map;Object.entries(v.value).forEach(([u,c])=>{if(u=="valid_to"||u=="valid_from"){if(c.value){let z=G(c==null?void 0:c.value);k(t,u,z)}}else u=="global"?(u="code",E(t,u,c==null?void 0:c.value)):k(t,u,c==null?void 0:c.value)}),t.set("page",d.value.page+1),t.set("per_page",d.value.rows),setTimeout(()=>{s(t)},Math.random()*1e3+250)}const s=async function(t){await w.fetchAllCoupons(t).then(()=>{h.value=!1}).catch(u=>{h.value=!1,N(S,u)})},n=t=>{d.value=t,e()},j=t=>{d.value=t,e()},B=()=>{d.value.page=0,d.value.filters=v.value,e()},I=function(t){a.setDetailType("coupon",!1,"Dettaglio coupon",t.id),a.updateSidebar(!0)},O=async function(){const t=new Map;await f.fetchAllUsers(t).catch(u=>{})};return{dt:g,responseCoupons:o,filters:v,loading:h,totalRecords:M,lazyParams:d,matchModes:D,currentCoupon:i,couponStore:w,users:F,onPage:n,onSort:j,onFilter:B,showSidebar:I,loadLazyData:e,getRowClass:function(t){return t!=null&&t.typology?t.typology:""},formatDataFromUnixTimestamps:H,formatNumber:J,formatDataFromSql:Q}},components:{}};const Y={class:"coupon"},Z={class:"flex justify-content-between align-items-center"},ee={class:"p-input-icon-left w-full mr-3 py-2"},oe=_("i",{class:"pi pi-search"},null,-1),te={class:"capitalize"},ae=_("div",{class:"flex justify-content-center w-full"},"Importo",-1),ne={class:"flex justify-content-center"},le={key:0},se={key:1},re=_("div",{class:"flex justify-content-center w-full"}," Coupon utilizzati ",-1),ie={class:"flex justify-content-center"},de={key:0},ue={key:1},ce={key:0},pe={key:0};function me(w,a,f,o,F,S){const g=y("InputText"),i=y("Column"),v=y("Dropdown"),h=y("Calendar"),d=y("Button"),M=y("DataTable"),D=L("tooltip");return p(),m("div",Y,[l(M,{value:o.responseCoupons.coupons,totalRecords:o.responseCoupons.total,lazy:!0,paginator:!0,rows:30,filters:o.filters,"onUpdate:filters":a[2]||(a[2]=e=>o.filters=e),ref:"dt",dataKey:"id",loading:o.loading,onPage:a[3]||(a[3]=e=>o.onPage(e)),onSort:a[4]||(a[4]=e=>o.onSort(e)),onFilter:a[5]||(a[5]=e=>o.onFilter()),filterDisplay:"row",removableSort:"",stripedRows:"",rowClass:o.getRowClass},{header:r(()=>[_("div",Z,[_("span",ee,[oe,l(g,{modelValue:o.filters.global.value,"onUpdate:modelValue":a[0]||(a[0]=e=>o.filters.global.value=e),placeholder:"Ricerca coupon",class:"border-none w-full",onChange:a[1]||(a[1]=e=>o.onFilter())},null,8,["modelValue"])])])]),empty:r(()=>[T(" Nessun coupon trovato. ")]),default:r(()=>[l(i,{field:"code",header:"Codice",filterMatchMode:"contains",ref:"code",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:r(({filterModel:e,filterCallback:s})=>[l(g,{type:"text",modelValue:e.value,"onUpdate:modelValue":n=>e.value=n,onKeydown:x(n=>s(),["enter"]),class:"p-column-filter",placeholder:"Filtra per codice"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1},512),l(i,{field:"typology",header:"Tipologia",filterMatchMode:"contains",ref:"typology",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{body:r(({data:e})=>[_("span",te,C(e.typology),1)]),filter:r(({filterModel:e,filterCallback:s})=>[l(v,{modelValue:e.value,"onUpdate:modelValue":n=>e.value=n,options:o.couponStore.couponsTypology,optionLabel:"name",optionValue:"value",onChange:n=>s(),placeholder:"Filtra per tipologia"},null,8,["modelValue","onUpdate:modelValue","options","onChange"])]),_:1},512),l(i,{field:"amount"},{header:r(()=>[ae]),body:r(({data:e})=>[_("div",ne,[e.amount?(p(),m("span",le,C(o.formatNumber(e.amount)+"")+" â‚¬",1)):(p(),m("span",se,"-"))])]),_:1}),l(i,{field:"quantity"},{header:r(()=>[re]),body:r(({data:e})=>[_("div",ie,[e.quantity&&e.typology=="promo"?(p(),m("span",de,C(e.used+" / "+e.quantity),1)):(p(),m("span",ue,"-"))])]),_:1}),l(i,{field:"valid_from",header:"Valido dal",ref:"valid_from",filterField:"valid_from",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{body:r(({data:e})=>[e.valid_from?(p(),m("div",ce,C(o.formatDataFromSql(e.valid_from)),1)):V("",!0)]),filter:r(({filterModel:e,filterCallback:s})=>[l(h,{inputId:"dateformat",modelValue:e.value,"onUpdate:modelValue":n=>e.value=n,dateFormat:"dd/mm/yy",onKeydown:x(n=>s(),["enter"]),manualInput:!0,placeholder:"Ricerca per data",onDateSelect:n=>s()},null,8,["modelValue","onUpdate:modelValue","onKeydown","onDateSelect"])]),_:1},512),l(i,{field:"valid_to",header:"Valido al",ref:"valid_to",filterField:"valid_to",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{body:r(({data:e})=>[e.valid_to?(p(),m("div",pe,C(o.formatDataFromSql(e.valid_to)),1)):V("",!0)]),filter:r(({filterModel:e,filterCallback:s})=>[l(h,{inputId:"dateformat",modelValue:e.value,"onUpdate:modelValue":n=>e.value=n,dateFormat:"dd/mm/yy",onKeydown:x(n=>s(),["enter"]),manualInput:!0,placeholder:"Ricerca per data",onDateSelect:n=>s()},null,8,["modelValue","onUpdate:modelValue","onKeydown","onDateSelect"])]),_:1},512),l(i,{field:"limit_to_user_id",ref:"limit_to_user_id",header:"Utente",filterField:"limit_to_user_id",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{body:r(({data:e})=>{var s;return[T(C(((s=e.limit_to_user)==null?void 0:s.email)||"-"),1)]}),filter:r(({filterModel:e,filterCallback:s})=>[l(v,{modelValue:e.value,"onUpdate:modelValue":n=>e.value=n,options:o.users,optionLabel:"email",optionValue:"id",class:"w-full",onChange:n=>s(),placeholder:"Filtra per email"},null,8,["modelValue","onUpdate:modelValue","options","onChange"])]),_:1},512),l(i,{header:"",style:{width:"4rem"}},{body:r(({data:e})=>[$(l(d,{type:"button",onClick:s=>o.showSidebar(e),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-3",icon:"pi pi-arrow-right",text:"",rounded:""},null,8,["onClick"]),[[D,"Dettaglio",void 0,{top:!0}]])]),_:1})]),_:1},8,["value","totalRecords","filters","loading","rowClass"])])}const _e=R(X,[["render",me]]),fe={setup(){const w=q(),a=U(()=>w.getTotalCoupons),f=K();return{totalCoupon:a,showSidebar:function(){f.setDetailType("coupon",!0,"Nuovo coupon",null),f.updateSidebar(!0),f.setShowDetail(!0)}}},components:{CouponTable:_e}},ve={class:"flex justify-content-between align-items-center"},he={class:""},ye={key:0},we={key:1};function ge(w,a,f,o,F,S){const g=y("Button"),i=y("CouponTable");return p(),m("div",null,[_("div",ve,[_("h1",he,[o.totalCoupon==1?(p(),m("span",ye," 1 Coupon")):(p(),m("span",we,C(o.totalCoupon)+" Coupon",1))]),l(g,{label:"Aggiungi coupon",onClick:a[0]||(a[0]=v=>o.showSidebar()),class:"mb-3",rounded:"",outlined:""})]),l(i)])}const xe=R(fe,[["render",ge]]);export{xe as default};
