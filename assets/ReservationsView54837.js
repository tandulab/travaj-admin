import{y as T,z as j,A as q,B as E,o as W,F as G,c as x,a as J,m as _,_ as z,r as R,b as h,e as y,g as v,f as c,q as V,w as u,h as P,i as f,s as C}from"../index54837.js";import{D as H,c as Q,k as A,f as X,e as Y,j as Z,d as ee,l as te}from"./helpers54837.js";import{u as U}from"./sidebar54837.js";import{u as ae}from"./workarea54837.js";class D{static async fetchAll(e){return(await T("/reservations",e)).data}static async getReservationDetail(e){return(await T(`/reservations/${e}`)).data.reservation}static async createReservation(e){return(await j("/reservations",e)).data.reservation}static async disableReservation(e){return(await T(`/reservations/${e}/disable`)).data}static async updateReservation(e){return(await q(`/reservations/${e.reservation.id}`,e)).data.reservation}}const K=E({id:"reservation",state:()=>({reservation:{},reservations:[],response_reservations:{},total_reservations:Number}),getters:{allReservations:a=>a.response_reservations.reservations,responseReservations:a=>a.response_reservations,getTotalReservations:a=>a.response_reservations?a.response_reservations.total:0,getCurrentReservation:a=>a.reservation},actions:{async fetchAllReservations(a){await D.fetchAll(a).then(e=>this.response_reservations=e)},async fetchReservationDetail(a){await D.getReservationDetail(a).then(e=>this.reservation=e)},async createReservation(a){await D.createReservation(a).then(e=>this.reservation=e)},async updateReservation(a){await D.updateReservation(a).then(e=>this.reservation=e)}}}),oe={setup(){W(()=>{r.value=H.now().toFormat("dd/LL/yyyy"),p.value=!0,l.value={first:0,rows:w.value.rows,sortField:null,sortOrder:null,filters:b.value},G.register("myfilter",(o,d)=>o===d),g(),L()});const a=K(),e=U(),i=ae(),s=x(()=>a.responseReservations),S=x(()=>i.workareas),k=J(),w=_(),m=_(),b=_({global:{value:null,matchMode:"contains"},full_name:{value:"",matchMode:"contains"},email:{value:"",matchMode:"contains"},workarea_id:{value:"",matchMode:"contains"},coupon_code:{value:"",matchMode:"contains"}}),p=_(!0),l=_(),t=_(0),n=_([{label:"Attivo",value:"true"},{label:"Disattivo",value:"false"}]),r=_(),F=_([{label:"My Filter",value:"myfilter"}]);function g(){p.value=!0;const o=new Map;if(Object.entries(b.value).forEach(([d,M])=>{Q(o,d,M==null?void 0:M.value)}),r.value){let d=A(r.value);d=="Invalid DateTime"&&(d=X(r.value)),o.set("from_date_lte",d),o.set("to_date_gte",d)}o.set("page",l.value.page+1),o.set("per_page",l.value.rows),l.value.sortField?l.value.sortOrder==1?o.set("sorted_by",l.value.sortField+"_asc"):o.set("sorted_by",l.value.sortField+"_desc"):o.set("sorted_by","start_at_asc"),setTimeout(()=>{N(o)},Math.random()*1e3+250)}const N=async function(o){await a.fetchAllReservations(o).then(()=>{p.value=!1}).catch(d=>{p.value=!1,Y(k,d)})},O=o=>{l.value=o,g()},I=o=>{l.value=o,g()},$=()=>{l.value.page=0,l.value.filters=b.value,g()},B=function(o){e.setDetailType("reservation",!1,"Dettaglio utente",o.id),e.updateSidebar(!0)},L=async function(){await i.fetchAllWorkarea()};return{dt:w,responseReservations:s,filters:b,loading:p,totalRecords:t,lazyParams:l,matchModes:F,status:n,currentReservation:m,workareas:S,filterDate:r,onPage:O,onSort:I,onFilter:$,showSidebar:B,loadLazyData:g,getRowClass:function(o){var d;return(d=o==null?void 0:o.workarea)!=null&&d.typology?o.workarea.typology:""},formatDataFromPrettyDate:A,formatDataFromSql:Z,formatDataFromUnixTimestamps:ee,formatPrettyDate:te}},components:{}};const se={class:"reservation"},re={class:"field col-2"},ne=v("label",{for:"calendar"},"Filtra per data",-1),le={key:0},ie={key:0},de={key:0},ce={class:"capitalize"},ue={class:"capitalize"},ve=v("br",null,null,-1),fe=v("br",null,null,-1);function _e(a,e,i,s,S,k){const w=R("Calendar"),m=R("Column"),b=R("Dropdown"),p=R("InputText"),l=R("DataTable");return h(),y("div",se,[v("div",re,[ne,c(w,{inputId:"calendar",modelValue:s.filterDate,"onUpdate:modelValue":e[0]||(e[0]=t=>s.filterDate=t),dateFormat:"dd/mm/yy",manualInput:!0,onKeydown:e[1]||(e[1]=V(t=>s.onFilter(),["enter"])),onDateSelect:e[2]||(e[2]=t=>s.onFilter())},null,8,["modelValue"])]),c(l,{value:s.responseReservations.reservations,totalRecords:s.responseReservations.total,lazy:!0,paginator:!0,rows:30,filters:s.filters,"onUpdate:filters":e[3]||(e[3]=t=>s.filters=t),ref:"dt",dataKey:"id",loading:s.loading,onPage:e[4]||(e[4]=t=>s.onPage(t)),onSort:e[5]||(e[5]=t=>s.onSort(t)),onFilter:e[6]||(e[6]=t=>s.onFilter()),filterDisplay:"row",removableSort:"",stripedRows:"",rowClass:s.getRowClass},{empty:u(()=>[P(" Nessuna prenotazione trovata. ")]),default:u(()=>[c(m,{field:"formatted_start_at",header:"Dalle",ref:"formatted_start_at"},{body:u(({data:t})=>[t.formatted_start_at?(h(),y("div",le,f(t.formatted_start_at),1)):C("",!0)]),_:1},512),c(m,{field:"formatted_end_at",header:"Alle",ref:"formatted_end_at"},{body:u(({data:t})=>[t.formatted_end_at?(h(),y("div",ie,f(t.formatted_end_at),1)):C("",!0)]),_:1},512),c(m,{field:"from_date",header:"Dal - Al",ref:"from_date"},{body:u(({data:t})=>[t.from_date?(h(),y("div",de,f(s.formatPrettyDate(t.from_date))+" - "+f(s.formatPrettyDate(t.to_date)),1)):C("",!0)]),_:1},512),c(m,{field:"workarea_id",header:"Area di lavoro",filterMatchMode:"contains",ref:"workarea_id",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{body:u(({data:t})=>{var n;return[v("span",ce,f((n=t.workarea)==null?void 0:n.name),1)]}),filter:u(({filterModel:t,filterCallback:n})=>[c(b,{modelValue:t.value,"onUpdate:modelValue":r=>t.value=r,options:s.workareas,optionLabel:"name",optionValue:"id",onChange:r=>n(),placeholder:"Filtra"},null,8,["modelValue","onUpdate:modelValue","options","onChange"])]),_:1},512),c(m,{field:"full_name",header:"Utente",filterMatchMode:"contains",ref:"full_name",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{body:u(({data:t})=>{var n,r,F;return[v("span",ue,f((n=t.user)==null?void 0:n.full_name),1),ve,v("span",null,f((r=t.user)==null?void 0:r.email),1),P(),fe,v("span",null,f((F=t.user)==null?void 0:F.phone_number),1)]}),filter:u(({filterModel:t,filterCallback:n})=>[c(p,{type:"text",modelValue:t.value,"onUpdate:modelValue":r=>t.value=r,onKeydown:V(r=>n(),["enter"]),class:"p-column-filter",placeholder:"Filtra"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1},512),c(m,{field:"coupon_code",header:"Rimborso",filterMatchMode:"contains",ref:"coupon_code",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{body:u(({data:t})=>{var n;return[v("span",null,f(((n=t.coupon)==null?void 0:n.code)||"-"),1)]}),filter:u(({filterModel:t,filterCallback:n})=>[c(p,{type:"text",modelValue:t.value,"onUpdate:modelValue":r=>t.value=r,onKeydown:V(r=>n(),["enter"]),class:"p-column-filter",placeholder:"Filtra"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1},512)]),_:1},8,["value","totalRecords","filters","loading","rowClass"])])}const me=z(oe,[["render",_e]]),pe={setup(){const a=K(),e=x(()=>a.getTotalReservations),i=U();return{totalReservations:e,showSidebar:function(){i.setDetailType("reservation",!0,"Nuova prenotazione",null),i.updateSidebar(!0),i.setShowDetail(!0)}}},components:{ReservationsTable:me}},he={class:"flex justify-content-between align-items-center"},ye={class:""},we={key:0},be={key:1};function Re(a,e,i,s,S,k){const w=R("ReservationsTable");return h(),y("div",null,[v("div",he,[v("h1",ye,[s.totalReservations==1?(h(),y("span",we," 1 Prenotazione")):(h(),y("span",be,f(s.totalReservations)+" Prenotazioni",1))])]),c(w)])}const Me=z(pe,[["render",Re]]);export{Me as default};
